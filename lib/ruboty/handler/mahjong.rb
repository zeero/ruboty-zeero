module Ruboty
  module Handlers
    class Mahjong < Base
      @@table = {
        "20" => [nil, "ツモアガリ(400/700)", "ツモアガリ(700/1300)", "ツモアガリ(1300/2600)"],
        "25" => [nil, "1600", "3200(800/1600)", "6400(1600/3200)"],
        "30" => ["1000(300/500)", "2000(500/1000)", "3900(1000/2000)", "7700(2000/3900)"],
        "40" => ["1300(400/700)", "2600(700/1300)", "5200(1300/2600)", "8000(2000/4000)"],
        "50" => ["1600(400/800)", "3200(800/1600)", "6400(1600/3200)", "8000(2000/4000)"],
        "60" => ["2000(500/1000)", "3900(1000/2000)", "7700(2000/3900)", "8000(2000/4000)"],
        "70" => ["2300(600/1200)", "4500(1200/2300)", "8000(2000/4000)", "8000(2000/4000)"],
        "80" => ["2600(700/1300)", "5200(1300/2600)", "8000(2000/4000)", "8000(2000/4000)"],
        "90" => ["2900(800/1500)", "5800(1500/2900)", "8000(2000/4000)", "8000(2000/4000)"],
        "100" => ["3200(800/1600)", "6400(1600/3200)", "8000(2000/4000)", "8000(2000/4000)"],
        "110" => ["3600(900/1800)", "7100(1800/3600)", "8000(2000/4000)", "8000(2000/4000)"],
      }

      on(
        /mj +(?<fu>[0-9]{1,3})((符|-| +)(?<han>[0-9])翻?)?/i,
        name: "mahjong",
        description: "麻雀の点数計算をします。"
      )

      def mahjong(msg)
        fu = msg[:fu]
        han = msg[:han] || "1"
        point = @@table[fu] ? @@table[fu][han.to_i - 1] : nil
        if point
          msg.reply("#{fu}符#{han}翻の点数は、#{point}です")
        else
          msg.reply("#{fu}符#{han}翻の点数は、わかりません")
        end
      end
    end
  end
end
